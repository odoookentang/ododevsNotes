<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mohon Tunggu...</title>
    <link rel="icon" type="image/x-icon" href="../fav.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Domine:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: "Domine", serif;
        }

        @media print {
            .noprint {
                display: none;
            }
        }
    </style>

<body>
    <nav class="navbar sticky-top p-3 noprint bg-light shadow">
        <div>
            <img src="../fav.ico" width="30px" />
            <h5>ododevsNotes</h5>
        </div>
        <div>
            <button class="btn btn-outline-dark" id="printBtn"><i class="bi-printer"></i></button>
            <button class="btn btn-outline-dark" id="saveBtn"><i class="bi-save"></i></button>
            <button id="delBtn" class="btn btn-outline-danger"><i class="bi-trash"></i></button>
        </div>
    </nav>
    <div class="container-sm">
        <div class="card p-3 mt-3" id="noteInfo">
        </div>
        <div id="editorjs" class="m-2"></div>
    </div>

    <!--<button id="parse" class="mt-5 noprint btn btn-outline-secondary">pRINT THIS SHIT</button>-->

    <script src="https://cdn.jsdelivr.net/npm/@editorjs/header@latest"></script><!-- Header -->
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/simple-image@latest"></script><!-- Image -->
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/delimiter@latest"></script><!-- Delimiter -->
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/checklist@latest"></script><!-- Checklist -->
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/code@latest"></script><!-- Code -->
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/embed@latest"></script><!-- Embed -->
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/table@latest"></script><!-- Table -->
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/link@latest"></script><!-- Link -->
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/warning@latest"></script><!-- Warning -->
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/marker@latest"></script><!-- Marker -->
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/inline-code@latest"></script><!-- Inline Code -->
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/underline@latest"></script><!-- Underline -->
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/nested-list@latest"></script><!-- NestedList -->
    <script src="https://cdn.jsdelivr.net/npm/editorjs-toggle-block"></script><!-- Toggle Block-->
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/editorjs@latest"></script><!-- EditorJS-->

    <!-- Initialization -->
    <script>

        var editor = new EditorJS({
            placeholder: "Tulis sesuatu di sini.",
            readOnly: false,
            holder: 'editorjs',
            /**
             * Common Inline Toolbar settings
             * - if true (or not specified), the order from 'tool' property will be used
             * - if an array of tool names, this order will be used
             */

            /**
             * Tools list
             */
            tools: {
                /**
                 * Each Tool is a Plugin. Pass them via 'class' option with necessary settings {@link docs/tools.md}
                 */
                header: {
                    class: Header,
                    config: {
                        placeholder: 'Header'
                    },
                    shortcut: 'CMD+SHIFT+H'
                },
                image: SimpleImage,

                list: {
                    class: NestedList,
                    inlineToolbar: true,
                    shortcut: 'CMD+SHIFT+L',
                    config: {
                        defaultStyle: 'ordered'
                    },
                },

                checklist: {
                    class: Checklist,
                    inlineToolbar: true,
                },

                toggle: {
                    class: ToggleBlock,
                    inlineToolbar: true,
                },

                underline: Underline,
                warning: Warning,
                Marker: Marker,

                code: {
                    class: CodeTool,
                    shortcut: 'CMD+SHIFT+C'
                },

                delimiter: Delimiter,

                inlineCode: {
                    class: InlineCode,
                    shortcut: 'CMD+SHIFT+C'
                },

                linkTool: LinkTool,

                embed: {
                    class: Embed,
                    inlineToolbar: true,
                },

                table: {
                    class: Table,
                    inlineToolbar: true,
                    shortcut: 'CMD+ALT+T'
                },

            },
        });
        document.getElementById("printBtn").addEventListener('click', Print)
        function Print() {
            document.activeElement.blur()
            window.print();
        }
    </script>
    <script type="module">
        // Import Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";

        // Firebase Configs
        const firebaseConfig = {
            apiKey: "AIzaSyBZaZsZw-4MIdsoaUJkWLzzvNOXRQwC7B4",
            authDomain: "ododevsnotes.firebaseapp.com",
            databaseURL: "https://ododevsnotes-default-rtdb.firebaseio.com",
            projectId: "ododevsnotes",
            storageBucket: "ododevsnotes.appspot.com",
            messagingSenderId: "423383404271",
            appId: "1:423383404271:web:c19f6271f0b0feee70d51a"
        };

        // firebase init
        const app = initializeApp(firebaseConfig);
        console.log("firebase initiated :D")

        // Realtime Database Prerequisites
        import { getDatabase, ref, set, get, child, update, remove } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js"
        console.log("imported firebase database :D")
        var db = getDatabase();

        function getURLValues() {
            var search = window.location.search.replace(/^\?/, '').replace(/\+/g, ' ').replace('n=', '');
            var result = decodeURIComponent(search);
            return result;
        }
        var result = getURLValues();
        console.log("the url is: " + result)

        var Icon = '';
        var Category = '';

        console.log("Notes2/" + result);
        window.onload = Open();
        function Open() {
            const dbRef = ref(db);
            get(child(dbRef, "Notes2/" + result)).then((snapshot) => {
                if (snapshot.exists()) {
                    console.log("the snapshot is found!")
                    if (snapshot.val().Note != "") {
                        editor.render(JSON.parse(snapshot.val().Note))
                    }
                    document.title = snapshot.val().Name
                    document.getElementById("noteInfo").innerHTML = `<p><i class="` + snapshot.val().Icon + `"></i> ` + snapshot.val().Tags + `</p><h2>` + snapshot.val().Name + `</h2>`
                    Icon = snapshot.val().Icon
                    Category = snapshot.val().Tags
                } else {
                    console.log("wtf")
                    document.getElementById("noteInfo").innerHTML = `<p><i class="bi-question-circle"></i></p><h2>Catatan Tidak Ditemukan!</h2>`
                    editor.destroy()
                }
            })
                .catch((error) => {
                    alert("Firebase error is: " + error)
                });
        }

        document.getElementById("saveBtn").addEventListener("click", SaveNote);
        function SaveNote() {
            editor.save().then((outputData) => {
                set(ref(db, "Notes2/" + result), {
                    Name: document.title,
                    Icon: Icon,
                    Tags: Category,
                    Note: JSON.stringify(outputData),
                    ID: result
                })
                    .then(() => {
                        console.log('saved successfully!');
                        alert("Catatan Disimpan!")
                    })
                    .catch((error) => {
                        alert("Firebase Error is: " + error);
                    });
            })

        }

        document.getElementById("delBtn").addEventListener("click", Delete);
        function Delete() {
            remove(ref(db, "Notes2/" + result))
                .then(() => {
                    editor.destroy();
                    alert("Mohon tutup tab ini, Catatan telah dihapus.")
                })
                .catch((error) => {
                    alert("Firebase error is " + error)
                })
        };
    </script>
</body>

</html>
