<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<title>ododevs Notes - Bahasa Inggris</title>
	<link rel="icon" type="image/x-icon" href="fav.ico">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
		crossorigin="anonymous"></script>
</head>
<style>
	.editor-preview h1,
	.editor-preview h2,
	.editor-preview h3,
	.editor-preview h4,
	.editor-preview h5 {
		margin-bottom: 10px
	}

	.editor-preview h1 {
		border-bottom: 3px solid #ddd
	}

	.editor-preview h1 {
		border-bottom: 3px solid #eee
	}
</style>

<body class="bg-light">
	<nav class="navbar bg-white shadow justify-content p-3">
		<div>

			<img src="logo.png" height="30px" width="30px"></img>
			<h5>ododevsNotes</h5>

		</div>
		<div>
			<h4>Bahasa Inggris</h4>
			<div class="btn-group">
				<a href="index.html" class="btn btn-dark">Kembali</a>
				<button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#selectModal">Buka Catatan</button>
				<button id="saveBtn" class="btn btn-dark">Simpan Catatan</button>
				<button id="delBtn" class="btn btn-dark">Hapus Catatan</button>
			</div>
		</div>
	</nav>
	<div class="modal fade" id="selectModal">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header>">
					<h5 class="modal-title fs-5 p-3" id="selectModal">Buka Catatan</h5>
				</div>
				<div class="modal-body">
					<table id="table" class="table text-white">
						<p>Ketik nama catatan yang ingin dibuka, kemudian klik "Buka Catatan".</p>
						<thead>
							<th>No.</th>
							<th>Nama Catatan</th>
							<th>Tanggal Dibuat</th>
						</thead>
						<tbody id="tbody1">
						</tbody>
					</table>
					<label>Ketikkan nama catatan:</label><br>
					<input type="text" id="noteOpen" class="form-control"></input>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
					<button type="button" id="openBtn" class="btn btn-primary" data-bs-dismiss="modal">Buka
						Catatan</button>
				</div>
			</div>
		</div>
	</div>
	<div class="m-3 p-3 card shadow">
		<label>Nama Catatan</label><input type="text" id="name" class="form-control"></input>
		<p id="date"></p>
		<textarea id="note">
		</textarea>
		</section>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
		<link rel="stylesheet" href="simplemde.min.css">
		<script src="simplemde.min.js"></script>
		<script>
			var simplemde = new SimpleMDE({
				element: document.getElementById("note"),
				showIcons: ["bold", "italic", "strikethrough", "quote", "code", "unordered-list", "ordered-list", "link", "image", "guide"],
				spellCheck: false,
				placeholder: "Ketik Disini...",
			});
		</script>
		<script type="module">
			// firebase import
			import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";

			// firebase yada yada yada, hey this is secret wtf
			const firebaseConfig = {
				apiKey: "AIzaSyBZaZsZw-4MIdsoaUJkWLzzvNOXRQwC7B4",
				authDomain: "ododevsnotes.firebaseapp.com",
				databaseURL: "https://ododevsnotes-default-rtdb.firebaseio.com",
				projectId: "ododevsnotes",
				storageBucket: "ododevsnotes.appspot.com",
				messagingSenderId: "423383404271",
				appId: "1:423383404271:web:c19f6271f0b0feee70d51a"
			};

			// firebase init
			const app = initializeApp(firebaseConfig);

			import { getDatabase, ref, set, get, child, update, remove } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js"
			const db = getDatabase();

			//references
			var today = new Date();
			var dd = String(today.getDate()).padStart(2, '0');
			var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
			var yyyy = today.getFullYear();
			today = dd + '/' + mm + '/' + yyyy;

			//functions
			//save, since update and save buttons does the exact same shit
			function Save() {
				if (emptychecker(document.getElementById("name").value)) {

				} else {
					set(ref(db, "Notes/" + "Bahasa Inggris/" + document.getElementById("name").value), {
						Name: document.getElementById("name").value,
						Note: simplemde.value(),
						Date: today
					})
						.then(() => {
							alert("Simpan Berhasil!");

						})
						.catch((error) => {
							alert("Firebase Error is: " + error);
						});
				}
			}

			//empty checker, for name only cuz it wont have any kind of subtree
			function emptychecker(str) {
				if (str.length < 1) {
					window.alert("Nama Catatan tidak bisa kosong.");
					return true;
				}
				else {
					return false;
				}
			}
			//open note
			function Open() {
				const dbRef = ref(db);
				get(child(dbRef, "Notes/" + "Bahasa Inggris/" + document.getElementById("noteOpen").value)).then((snapshot) => {
					if (snapshot.exists()) {
						document.getElementById("name").value = snapshot.val().Name;
						simplemde.value(snapshot.val().Note);
						//document.getElementById("date").value = "Last Edited: " + snapshot.val().Date;

					} else {
						alert("Tidak ada catatan ditemukan dengan nama ini. Mohon ketikkan nama dengan benar.");
					}
				})
					.catch((error) => {
						alert("Firebase error is: " + error)
					});
			}

			//delete note
			function Delete() {
				if (emptychecker(document.getElementById("name").value)) {
				} else {
					if (confirm("Hapus Catatan - Apakah kamu yakin?")) {
						remove(ref(db, "Notes/" + "Bahasa Inggris/" + document.getElementById("name").value))
							.then(() => {
								document.getElementById("name").value = ""
								simplemde.value("")
								window.location.reload();
								alert("Catatan dihapus.");
							})
							.catch((error) => {
								alert("Firebase error is " + error)
							})
					} else {
					}

				}
			};

			var noteNo = 0;
			var tbody = document.getElementById("tbody1");

			//add item to table
			function AddItemToTable(name, note, date) {
				let trow = document.createElement("tr");
				let td1 = document.createElement("td");
				let td2 = document.createElement("td");
				let td4 = document.createElement("td");

				td1.innerHTML = ++noteNo;
				td2.innerHTML = name;
				td4.innerHTML = date;

				trow.appendChild(td1);
				trow.appendChild(td2);
				trow.appendChild(td4);

				tbody.appendChild(trow);
			}

			//add items to the table
			function AddItemsToTable(notes) {
				noteNo = 0;
				tbody.innerHTML = "";
				notes.forEach(element => {
					AddItemToTable(element.Name, element.Note, element.Date);
				});
			}

			//fetch data from firebase
			function FetchDataAllOnce() {
				const dbref = ref(db);

				get(child(dbref, "Notes/Bahasa Inggris/"))
					.then((snapshot) => {
						var notes = [];
						snapshot.forEach(childSnapshot => {
							notes.push(childSnapshot.val());
						});
						AddItemsToTable(notes);
					})
			}
			window.onload = FetchDataAllOnce();
			window.onload = simplemde.value("");
			openBtn.addEventListener('click', Open);
			saveBtn.addEventListener('click', Save);
			delBtn.addEventListener('click', Delete);
		</script>
</body>

</html>