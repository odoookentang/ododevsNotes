<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ododevs Notes</title>
    <link rel="icon" type="image/x-icon" href="fav.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Domine:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<style>
    body {
        font-family: "Domine", serif;
    }

    .noteselect {
        border-radius: 5px;
        background: #fff;
        transition: .2s ease-out, .2s box-shadow;
    }

    .noteselect:hover {
        transform: scale(1.01);
        box-shadow: 0px 1px 0px rgba(0, 0, 0, .20), 0 4px 10px rgba(0, 0, 0, .16);
        background-color: #fbffff;
    }
</style>

<body>
    <div class="modal fade" id="createModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header>">
                    <h5 class="modal-title fs-5 p-3" id="createModal">Catatan Baru</h5>
                </div>
                <div class="modal-body">
                    <div class="input-group mb-3">
                        <label class="input-group-text">Tag</label>
                        <input id="Category" class="form-control d-inline" type="text" placeholder="IPA"></input>
                    </div>
                    <div class="input-group mb-3">
                        <label class="input-group-text">Nama Catatan</label>
                        <input id="Name" class="form-control d-inline" type="text"
                            placeholder="Nama Catatan..."></input>
                    </div>
                    <div class="input-group mb-3">
                        <label class="input-group-text">Ikon Catatan</label>
                        <input id="Icon" class="form-control d-inline" type="text"
                            placeholder="Nama Ikon (Referensi Ikon Bootstrap)" value="journal"></input>
                        <div id='preview' class="card p-1">Preview: <i class='bi-journal'></i></div>
                    </div>
                    <div id="echeckToast" class="toast" role="alert" aria-atomic="true">
                        <div class="toast-header">
                            <strong class="mr-auto text-danger">Mohon cek nama catatan (nama catatan tidak boleh
                                kosong!)</strong>
                        </div>
                        <div class="toast-body">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Batal</button>
                        <button id="createNote" type="button" class="btn btn-outline-success">Buat</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <nav class="navbar sticky-top p-3 shadow bg-white">
        <div>
            <img height="30px" src="logo.png" />
            <h5>ododevsNotes</h5>
        </div>
        <div>
            <button id="refresh" class="btn btn-outline-secondary"><i class="bi-arrow-clockwise"></i>
                Segarkan</button>
            <button id="create" class="btn btn-outline-success"><i class="bi-plus-lg"></i> Baru..</button>
        </div>
    </nav>
    <div class="container-sm p-2">
        <div>
            <div id="noteNameOpen" class="mt-4">
                <div class="card p-2 noteselect">
                    <i class="text-muted bi-pencil-square"></i>
                    <p class="placeholder-wave">
                        <span class="placeholder col-11 rounded-3"></span>
                        <span class="placeholder col-7 rounded-3"></span>
                    </p>
                </div>
            </div>
        </div>
        <hr class="m-4">
        <p class="text-muted" style="text-align: center;">ododevsNotes release 4.0 | with <i class="bi-heart-fill"></i>
            by Muhammad Hafidz Ridho</p>
    </div>
    <script type="module">
        // Import Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";

        // Firebase Configs
        const firebaseConfig = {
            apiKey: "",
            authDomain: "",
            databaseURL: "",
            projectId: "",
            storageBucket: "",
            messagingSenderId: "",
            appId: ""
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        console.log("firebase initiated :D")

        // Realtime Database Prerequisites
        import { getDatabase, ref, set, get, child, update, remove, query, orderByChild } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js"
        console.log("imported firebase database :D")
        var db = getDatabase();

        var noteNameOpen = document.getElementById("noteNameOpen")
        function AddItemToTable(name, cat, icon, id) {
            let opt = document.createElement("div");
            opt.innerHTML = `<a style="text-decoration: none" href="https://ododevsnotes.web.app/note?n=` + id + `" target="_blank"><div class="mb-2 card p-2 noteselect"><i class="text-muted ` + icon + `"></i>` + cat + `<h3>` + name + `</h3></div>`;
            noteNameOpen.appendChild(opt)
        }
        // Fetch All Data Once
        var dbref = ref(db)
        window.onload = FetchAllDataOnce
        document.getElementById("refresh").addEventListener('click', FetchAllData);
        function FetchAllDataOnce() {
            noteNameOpen.innerHTML = `<div class="card p-2"><i class="text-muted bi-pencil-square"></i><p class="placeholder-wave"><span class="placeholder col-11 rounded-3"></span><span class="placeholder col-7 rounded-3"></span></p></div>`

            console.log("Fetch Triggered!")
            get(child(dbref, "Notes2/"))
                .then((snapshot) => {
                    var notes = [];
                    snapshot.forEach(childSnapshot => {
                        notes.push(childSnapshot.val());
                    });
                    AddItemsToTable(notes);
                })
        }
        function FetchAllData() {
            noteNameOpen.innerHTML = `<div class="card p-2"><i class="text-muted bi-pencil-square"></i><p class="placeholder-wave"><span class="placeholder col-11 rounded-3"></span><span class="placeholder col-7 rounded-3"></span></p></div>`
            get(child(dbref, "Notes2/"))
                .then((snapshot) => {
                    var notes = [];
                    snapshot.forEach(childSnapshot => {
                        notes.push(childSnapshot.val());
                    });
                    AddItemsToTable(notes);
                })
        }

        function AddItemsToTable(notes) {
            noteNameOpen.innerHTML = ``;
            notes.forEach(element => {
                AddItemToTable(element.Name, element.Tags, element.Icon, element.ID);
            });

        }

        var selectModal = new bootstrap.Modal(document.getElementById('createModal'));
        document.getElementById("create").addEventListener("click", showSelectModal);
        function showSelectModal() {
            selectModal.show();
        }

        document.getElementById("Icon").addEventListener('input', iconPreview);
        function iconPreview() {
            document.getElementById('preview').innerHTML = `Preview: <i class='bi-` + document.getElementById('Icon').value + `'></i>`
        }

        function EmptyChecker(str) {
            if (str.length < 1) {
                console.log("emptystrchecker returned true :(")
                return true;

            }
            else {
                console.log("emptystrchecker returned false :D");
                return false;

            }
        }

        var echeckToast = new bootstrap.Toast(document.getElementById('echeckToast'));
        document.getElementById('createNote').addEventListener('click', CreateNote);
        function CreateNote() {
            if (EmptyChecker(document.getElementById("Name").value) && EmptyChecker(document.getElementById("Category").value)) {
                echeckToast.show();
            } else {
                var rand = Math.floor(Math.random() * 99999999999)
                set(ref(db, "Notes2/" + rand), {
                    Name: document.getElementById("Name").value,
                    Tags: document.getElementById("Category").value.toUpperCase().trim(),
                    Icon: "bi-" + document.getElementById("Icon").value,
                    Note: '',
                    ID: rand,
                })
                    .then(() => {
                        console.log('created successfully!');
                        FetchAllDataOnce();
                        selectModal.hide()
                    })
                    .catch((error) => {
                        alert("Firebase Error is: " + error);
                    });
            }
        }
    </script>
</body>

</html>