<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<title>ododevs Notes - Agama Islam</title>
	<link rel="icon" type="image/x-icon" href="fav.ico">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="stylesheet.css" media="screen">
	<link rel="stylesheet" type="text/css" href="github-light.css" media="screen">
	<link rel="stylesheet" type="text/css" href="normalize.css" media="screen">
	<style>
		.editor-preview h1,
		.editor-preview h2,
		.editor-preview h3,
		.editor-preview h4,
		.editor-preview h5 {
			margin-bottom: 10px;
		}

		.editor-preview h1 {
			border-bottom: 1px solid #ddd;
		}

		.editor-preview h1 {
			border-bottom: 1px solid #eee;
		}

		.table {
			width: 100%;
			margin-bottom: 1rem;
			color: #212529
		}

		.table td,
		.table th {
			padding: .75rem;
			vertical-align: top;
			border-top: 1px solid #dee2e6
		}

		.table thead th {
			vertical-align: bottom;
			border-bottom: 2px solid #dee2e6
		}

		.table tbody+tbody {
			border-top: 2px solid #dee2e6
		}

		.text-white {
			color: #fff !important
		}
	</style>
</head>

<body>
	<div class="page-header">
		<a href="index.html" class="btn">
			Go Back</a><br>
		<h1 class="">Agama Islam</h1><br>
		<button id="openBtn" class="btn">Open Note</button>
		<button id="saveBtn" class="btn">Save Note</button>
		<button id="delBtn" class="btn">Delete Note</button>
		<div>
			<table id="table" class="table text-white">
				<p>Type the name of the Note you want to open, then click on "Open Note".</p>
				<thead>
					<th>No.</th>
					<th>Note Name</th>
					<th>Date Created</th>
				</thead>
				<tbody id="tbody1">
				</tbody>
			</table>
		</div>
	</div>

	<section class="main-content">
		<label>Note Name</label><br><input id="name" type="text">
		</input>
		<p id="date"></p>
		<textarea id="note">
		</textarea>
	</section>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
	<link rel="stylesheet" href="simplemde.min.css">
	<script src="simplemde.min.js"></script>
	<script>
		var simplemde = new SimpleMDE({
			element: document.getElementById("note"),
			showIcons: ["heading-bigger", "bold", "italic", "strikethrough", "quote", "code", "unordered-list", "ordered-list", "link", "image", "guide"],
			autosave: {
				enabled: true,
				delay: 200,
				uniqueId: "Agama Islam",
			},
			spellcheck: false,
			placeholder: "Type Here...",
		});
	</script>
	<script type="module">
		// firebase import
		import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";

		// firebase yada yada yada, hey this is secret wtf
		const firebaseConfig = {
			apiKey: "AIzaSyBZaZsZw-4MIdsoaUJkWLzzvNOXRQwC7B4",
			authDomain: "ododevsnotes.firebaseapp.com",
			databaseURL: "https://ododevsnotes-default-rtdb.firebaseio.com",
			projectId: "ododevsnotes",
			storageBucket: "ododevsnotes.appspot.com",
			messagingSenderId: "423383404271",
			appId: "1:423383404271:web:c19f6271f0b0feee70d51a"
		};

		// firebase init
		const app = initializeApp(firebaseConfig);

		import { getDatabase, ref, set, get, child, update, remove } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js"
		const db = getDatabase();

		//references
		var today = new Date();
		var dd = String(today.getDate()).padStart(2, '0');
		var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
		var yyyy = today.getFullYear();
		today = mm + '/' + dd + '/' + yyyy;

		//functions
		//save, since update and save buttons does the exact same shit
		function Save() {
			if (emptychecker(document.getElementById("name").value)) {

			} else {
				set(ref(db, "Notes/" + "Agama Islam/" + document.getElementById("name").value), {
					Name: document.getElementById("name").value,
					Note: simplemde.value(),
					Date: today
				})
					.then(() => {
						alert("Save Success!");
						
					})
					.catch((error) => {
						alert("How did this happen? Firebase error is " + error);
					});
			}
		}

		//empty checker, for name only cuz it wont have any kind of subtree
		function emptychecker(str) {
			if (str.length < 1) {
				window.alert("Note Name field can't be left empty");
				return true;
			}
			else {
				return false;
			}
		}
		//open
		function Open() {
			if (emptychecker(document.getElementById("name").value)) {
			} else {
				const dbRef = ref(db);
				get(child(dbRef, "Notes/" + "Agama Islam/" + document.getElementById("name").value)).then((snapshot) => {
					if (snapshot.exists()) {
						document.getElementById("name").value = snapshot.val().Name;
						simplemde.value(snapshot.val().Note);
						document.getElementById("date").value = "Last Edited: " + snapshot.val().Date;
						alert("Document Opened!")
					} else {
						alert("No notes found with this name. Please type the name correctly.");
					}
				})
					.catch((error) => {
						alert("How did this happen? Firebase error is " + error)
					});
			}

		}

		//delet note
		function Delete() {
			if (emptychecker(document.getElementById("name").value)) {
			} else {
				if (confirm("Are you sure?")) {
					remove(ref(db, "Notes/" + "Agama Islam/" + document.getElementById("name").value))
						.then(() => {
							alert("Note Deleted");
							document.getElementById("name").value = ""
							simplemde.value("")
						})
						.catch((error) => {
							alert("How did this happen? Firebase error is " + error)
						})
				} else {
				}

			}
			window.location.reload();
		};

		var noteNo = 0;
		var tbody = document.getElementById("tbody1");

		function AddItemToTable(name, note, date) {
			let trow = document.createElement("tr");
			let td1 = document.createElement("td");
			let td2 = document.createElement("td");
			let td4 = document.createElement("td");

			td1.innerHTML = ++noteNo;
			td2.innerHTML = name;
			td4.innerHTML = date;

			trow.appendChild(td1);
			trow.appendChild(td2);
			trow.appendChild(td4);

			tbody.appendChild(trow);
		}

		function AddItemsToTable(notes) {
			noteNo = 0;
			tbody.innerHTML = "";
			notes.forEach(element => {
				AddItemToTable(element.Name, element.Note, element.Date);
			});
		}

		function FetchDataAllOnce() {
			const dbref = ref(db);

			get(child(dbref, "Notes/Agama Islam/"))
				.then((snapshot) => {
					var notes = [];
					snapshot.forEach(childSnapshot => {
						notes.push(childSnapshot.val());
					});
					AddItemsToTable(notes);
				})
		}
		window.onload = FetchDataAllOnce();
		openBtn.addEventListener('click', Open);
		saveBtn.addEventListener('click', Save);
		delBtn.addEventListener('click', Delete);
	</script>
</body>

</html>